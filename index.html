<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>翰译翻译 Todo APP 0.002版（四象限·自包含）</title>

  <style>
    :root{
      --topbar-h:56px;
      --text:#222; --muted:#666; --line:#e9ecef; --gap:16px;

      /* 四象限主题色 */
      --q1:#ff6b6b;   /* 重要+紧急：红 */
      --q2:#51cf66;   /* 重要不紧急：绿 */
      --q3:#74c0fc;   /* 紧急不重要：蓝 */
      --q4:#8fa6b3;   /* 不重要不紧急：灰蓝 */
    }
    *{ box-sizing:border-box; }
    html,body{ margin:0; padding:0; font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica,Arial,sans-serif; color:var(--text); }

    /* 顶部条 */
    .topbar{
      position:fixed; inset:0 0 auto 0; height:var(--topbar-h);
      display:flex; align-items:center; justify-content:center;
      background:#fff; border-bottom:1px solid #eee; font-weight:800; font-size:18px; z-index:10;
    }

    /* 容器 */
    .container{ max-width:980px; margin:calc(var(--topbar-h) + 12px) auto 24px; padding:0 14px; }

    /* 四象限布局（桌面 2 列；移动 1 列） */
    .matrix{
      position:relative;
      display:grid; grid-template-columns:1fr 1fr; grid-auto-rows:minmax(220px,auto);
      gap:var(--gap);
      margin-top:4px;
      background:
        linear-gradient(to right,
          transparent calc(50% - .5px), var(--line) calc(50% - .5px),
          var(--line) calc(50% + .5px), transparent calc(50% + .5px)),
        linear-gradient(to bottom,
          transparent calc(50% - .5px), var(--line) calc(50% - .5px),
          var(--line) calc(50% + .5px), transparent calc(50% + .5px));
      border-radius:12px;
      padding:8px;
    }
    .quad{ min-width:0; padding:8px; }
    .quad h3{ margin:0 0 10px; font-size:16px; font-weight:800; color:var(--muted); }

    /* 输入条（Flex，照顾 iOS Safari） */
    .q-form{
      min-width:0; width:100%;
      display:flex; align-items:center; gap:10px;
      background:#18b89d; /* 默认色，下面会被每个象限覆盖 */
      padding:10px; border-radius:12px; margin-bottom:10px;
    }
    .q-input{
      flex:1 1 auto; min-width:0; width:100%;
      height:44px; border-radius:22px; padding:0 14px; border:none; outline:none;
      color:#fff; background:rgba(255,255,255,.33);
      font-size:16px; /* 防 iOS 输入放大 */
      -webkit-appearance:none;
    }
    .q-input::placeholder{ color:rgba(255,255,255,.9); }
    .q-add{
      flex:0 0 auto;
      width:48px; height:48px; border-radius:50%; border:none; cursor:pointer;
      background:#fff; display:inline-flex; align-items:center; justify-content:center;
      font-size:24px; line-height:1; -webkit-tap-highlight-color:transparent;
    }

    /* 每象限输入条使用自有主题色 + 小光环 */
    .q1 .q-form{ background: var(--q1); }
    .q2 .q-form{ background: var(--q2); }
    .q3 .q-form{ background: var(--q3); }
    .q4 .q-form{ background: var(--q4); }

    /* 兼容性好的“光环”写法：用半透明边框模拟 */
    .q1 .q-add{ border:3px solid rgba(255,107,107,.35); }
    .q2 .q-add{ border:3px solid rgba(81,207,102,.35); }
    .q3 .q-add{ border:3px solid rgba(116,192,252,.35); }
    .q4 .q-add{ border:3px solid rgba(143,166,179,.35); }

    /* 列表与任务项 */
    ul.todo{ list-style:none; margin:0; padding:0; }
    .task{
      display:flex; align-items:center; gap:10px;
      background:#fff; border:1px solid #eee; border-radius:10px; padding:10px 12px; margin:8px 0;
      box-shadow:0 1px 2px rgba(0,0,0,.03);
    }
    .q-badge{ flex:0 0 auto; min-width:32px; text-align:center; font-size:12px; color:#fff; border-radius:999px; padding:4px 8px; }
    .q1 .q-badge{ background: var(--q1); } .q2 .q-badge{ background: var(--q2); }
    .q3 .q-badge{ background: var(--q3); } .q4 .q-badge{ background: var(--q4); }

    /* 给任务卡片加一条主题色竖条（增强层次） */
    .q1 .task{ border-left:4px solid var(--q1); }
    .q2 .task{ border-left:4px solid var(--q2); }
    .q3 .task{ border-left:4px solid var(--q3); }
    .q4 .task{ border-left:4px solid var(--q4); }

    .text{ flex:1 1 auto; min-width:0; word-break:break-word; }
    .actions{ display:flex; gap:6px; }
    .btn{
      border:1px solid #e5e5e5; background:#fafafa; border-radius:8px; height:34px; padding:0 10px; cursor:pointer; font-size:14px;
    }

    /* 已完成 */
    .completed-wrap{ margin-top:18px; }
    .completed-wrap h3{ margin:0 0 8px; font-size:16px; font-weight:800; color:var(--muted); }

    /* —— 手机：单列 + 去掉十字线 —— */
    @media (max-width: 820px){
      .matrix{ grid-template-columns:1fr; background:none; padding:0; }
      .quad{ padding:0; border-bottom:1px solid #f1f3f5; }
    }
  </style>
</head>
<body>
  <div class="topbar">翰译翻译 Todo APP 0.002版</div>

  <div class="container">
    <div class="matrix">
      <section class="quad q1">
        <h3>Q1 重要且紧急</h3>
        <div class="q-form" data-q="1">
          <input class="q-input" type="text" placeholder="输入 Q1 任务…" />
          <button class="q-add" type="button" aria-label="添加Q1">＋</button>
        </div>
        <ul class="todo" id="q1"></ul>
      </section>

      <section class="quad q2">
        <h3>Q2 重要不紧急</h3>
        <div class="q-form" data-q="2">
          <input class="q-input" type="text" placeholder="输入 Q2 任务…" />
          <button class="q-add" type="button" aria-label="添加Q2">＋</button>
        </div>
        <ul class="todo" id="q2"></ul>
      </section>

      <section class="quad q3">
        <h3>Q3 紧急不重要</h3>
        <div class="q-form" data-q="3">
          <input class="q-input" type="text" placeholder="输入 Q3 任务…" />
          <button class="q-add" type="button" aria-label="添加Q3">＋</button>
        </div>
        <ul class="todo" id="q3"></ul>
      </section>

      <section class="quad q4">
        <h3>Q4 不重要不紧急</h3>
        <div class="q-form" data-q="4">
          <input class="q-input" type="text" placeholder="输入 Q4 任务…" />
          <button class="q-add" type="button" aria-label="添加Q4">＋</button>
        </div>
        <ul class="todo" id="q4"></ul>
      </section>
    </div>

    <div class="completed-wrap">
      <h3>已完成</h3>
      <ul class="todo" id="completed"></ul>
    </div>
  </div>

  <script>
    (function(){
      const $ = (s, r=document)=>r.querySelector(s);
      const $$=(s, r=document)=>Array.from(r.querySelectorAll(s));
      const STORE_KEY='hy_todo_v1';
      let state={tasks:[]}; // {id,text,quadrant,completed,createdAt}

      function save(){ localStorage.setItem(STORE_KEY, JSON.stringify(state)); }
      function load(){
        try{ const raw=localStorage.getItem(STORE_KEY); if(raw) state=JSON.parse(raw); }catch{}
        if(!state||!Array.isArray(state.tasks)) state={tasks:[]};
      }

      const lists={ "1":$('#q1'), "2":$('#q2'), "3":$('#q3'), "4":$('#q4'), completed:$('#completed') };

      function makeLi(t){
        const li=document.createElement('li'); li.className='task'; li.dataset.id=t.id;
        const badge=document.createElement('span'); badge.className='q-badge'; badge.textContent=['Q1','Q2','Q3','Q4'][t.quadrant-1];
        const text=document.createElement('span'); text.className='text'; text.textContent=t.text;
        const actions=document.createElement('div'); actions.className='actions';
        const done=document.createElement('button'); done.className='btn complete'; done.textContent=t.completed?'取消完成':'完成';
        const del=document.createElement('button'); del.className='btn delete'; del.textContent='删除';
        actions.append(done,del); li.append(badge,text,actions); return li;
      }
      function mount(t,top=true){
        const ul=t.completed?lists.completed:lists[String(t.quadrant)]; if(!ul) return;
        const li=makeLi(t); top?ul.prepend(li):ul.append(li);
      }
      function render(){
        Object.values(lists).forEach(ul=>ul.innerHTML='');
        state.tasks.slice().sort((a,b)=> (a.completed-b.completed)||(b.createdAt-a.createdAt)).forEach(t=>mount(t,true));
      }

      function add(text,q){
        const t={ id:Date.now()+'-'+Math.random().toString(36).slice(2,8), text:text.trim(), quadrant:Number(q)||2, completed:false, createdAt:Date.now() };
        state.tasks.unshift(t); save(); mount(t,true);
      }
      function remove(id){
        const i=state.tasks.findIndex(t=>t.id===id); if(i<0) return;
        state.tasks.splice(i,1); save();
        const li=document.querySelector('[data-id="'+id+'"]'); if(li&&li.parentElement) li.parentElement.removeChild(li);
      }
      function toggle(id){
        const t=state.tasks.find(x=>x.id===id); if(!t) return;
        t.completed=!t.completed; save();
        const old=document.querySelector('[data-id="'+id+'"]'); if(old&&old.parentElement) old.parentElement.removeChild(old);
        mount(t,true);
      }

      // 输入 + 按回车
      $$('.q-form').forEach(box=>{
        const q=box.getAttribute('data-q')||'2';
        const input=$('.q-input',box); const btn=$('.q-add',box);
        const create=()=>{ const val=(input.value||'').trim(); if(!val) return; add(val,q); input.value=''; input.focus(); };
        btn.addEventListener('click',create);
        input.addEventListener('keydown',e=>{
          if(e.isComposing||e.keyCode===229) return;
          if(e.key==='Enter'||e.keyCode===13){ e.preventDefault(); create(); }
        });
      });

      // 完成 / 删除（委托）
      document.addEventListener('click',e=>{
        const btn=e.target.closest?.('.btn'); if(!btn) return;
        const li=e.target.closest?.('.task'); if(!li) return;
        const id=li.dataset.id;
        if(btn.classList.contains('delete')) return remove(id);
        if(btn.classList.contains('complete')) return toggle(id);
      });

      load(); render();
    })();
  </script>
</body>
</html>
